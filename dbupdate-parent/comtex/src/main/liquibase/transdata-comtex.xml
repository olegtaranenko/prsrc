<?xml version="1.0" encoding="UTF-8"?>
 
<databaseChangeLog
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd"
  logicalFilePath="transdata-comtex.xml"
>
         
    <changeSet id="1" author="ddl-comtex.sql">
    	<comment>Recreate foreign keys of table "compl" to make it cascade.</comment>
        <dropForeignKey baseTableName="compl" constraintName="compl_2_inv"/>
        <dropForeignKey baseTableName="compl" constraintName="compl_2_inv_belong"/>

        <addForeignKeyConstraint constraintName="compl_2_inv"
            baseTableName="compl" baseColumnNames="id_inv"
            referencedTableName="inv" referencedColumnNames="id" onDelete="CASCADE" onUpdate="CASCADE"
        />
        <addForeignKeyConstraint constraintName="compl_2_inv_belong"
            baseTableName="compl" baseColumnNames="id_inv_belong"
            referencedTableName="inv" referencedColumnNames="id" onDelete="CASCADE" onUpdate="CASCADE"
        />
    </changeSet>

    <changeSet id="2" author="ddl-comtex.sql">
    	<comment>После какого-то апдейта комтеха перестали удаляться пустые каталоги из справочника sGuideSeries.
    	В foreign constraint-х не было разрешено каскадное удаление</comment>
        <dropForeignKey baseTableName="mat" constraintName="mat_id_inv"/>
        <dropForeignKey baseTableName="scet" constraintName="fk_scet_inv"/>

        <addForeignKeyConstraint constraintName="mat_id_inv"
            baseTableName="mat" baseColumnNames="id_inv"
            referencedTableName="inv" referencedColumnNames="id" onDelete="CASCADE" onUpdate="CASCADE"
        />
        <addForeignKeyConstraint constraintName="fk_scet_inv"
            baseTableName="scet" baseColumnNames="id_inv"
            referencedTableName="inv" referencedColumnNames="id" onDelete="CASCADE" onUpdate="CASCADE"
        />
    </changeSet>


</databaseChangeLog>
